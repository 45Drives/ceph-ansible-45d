---
- name: 45Drives Repository - Configure 45drives repository
  yum_repository:
    name: ceph_45drives
    description: 45Drives $basearch repo
    gpgcheck: no
    enabled: yes
    state: present
    baseurl: "{{ ceph_45drives_repo_url }}"
    file: ceph_45drives
    priority: "1"
  register: result
  until: result is success

- name: install tools
  package:
    name: 45drives-tools
    state: "{{ (upgrade_ceph_packages|bool) | ternary('latest','present') }}"
  register: result
  until: result is succeeded

- name: Install alias udev rules
  command: sh "{{ tools_install_dir }}"/alias_setup.sh

- name: Create drive alias' for standard chassis
  command: sh "{{ tools_install_dir }}"/dmap -s "{{ chassis_size }}"
  when: not hybrid_chassis | bool

- name: Create drive alias' for hybrid chassis
  command: sh "{{ tools_install_dir }}"/hmap -s "{{ chassis_size }}"
  when: hybrid_chassis | bool

- name: Get drive layout
  command: sh "{{ tools_install_dir }}"/lsdev -n
  register: drive_layout
  changed_when: false
  when: not hybrid_chassis | bool

- name: Show drive layout
  debug:
    msg: "{{ drive_layout.stdout_lines }}"
  when: 
   - not drive_layout.failed
   - not hybrid_chassis | bool
